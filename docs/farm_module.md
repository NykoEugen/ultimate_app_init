# Модуль «Ферма»

Цей документ узагальнює новий фермерський модуль, що розширює базову RPG-систему прогресії.

## Ключові можливості

- **Каталог культур** з плавним відкриттям нових рослин за рівнем героя та фермерства.
- **Прогресія фермерства** зі своїм XP, рівнями, енергією та бонусами інструменту.
- **Керування ділянками**: стартові 3 осередки безкоштовні, решта відкриваються за золото та вимоги до рівня.
- **Енергія ферми** – витрачається на посадку, пасивно відновлюється (1 ⚡ кожні ~10 хв) або поповнюється за золото.
- **Подарункове насіння** – кожен гравець отримує заряд стартових насінин, що дозволяє посадити першу культуру без витрат золота.
- **Інструменти** – покращення скорочують час дозрівання.
- **Казуальний геймплей** без жорстких штрафів: зрілі врожаї не зникають, експерименти безпечні.

## Структура даних

- `farm_plant_catalog`: довідник культур (вартість насіння, XP, енергія, час росту, вимоги).
- `farm_player_stats`: окремий прогрес гравця у фермерстві (рівень, XP, енергія, інструмент).
- `farm_plots`: ділянки гравця (стан, вимоги для відкриття, поточний засів).
- `farm_planted_crops`: активні посадки з таймерами дозрівання.

Звʼязки додаються до `Player` як `farming_stats` та `farm_plots`.

## API

Базовий префікс: `/farm/{player_id}`

- `GET /` – повний стан ферми: статистика, ділянки, доступні культури та `wallet_gold`.
- `POST /plant` – посадити культуру (`plot_id`, `plant_type_id`).
- `POST /harvest` – зібрати врожай (`plot_id`).
- `POST /plots/{plot_id}/unlock` – відкрити нову ділянку.
- `POST /tool/upgrade` – покращити інструмент.
- `POST /energy/refill` – поповнити енергію (`amount` або добрати до максимуму).

Сервіс початкового привітання доступний за `/player/{player_id}/onboarding` (GET повертає статус та кроки, POST `/complete` завершує привітання).

Кожна дія повертає оновлений стан ферми та коротке повідомлення для UI.

## Frontend UX

- Нова сторінка `/farm` з мʼякою айдентикою, картками ділянок та каталогом культур.
- Прогрес-бари показують XP фермерства та запас енергії.
- Кнопки швидких дій:
  - посадка доступних культур напряму з ділянки;
  - поповнення енергії (+10 або до максимуму);
  - апгрейд інструмента;
  - оновлення стану без перезавантаження всієї сторінки.
- Повідомлення успіху/помилок через `react-hot-toast`.

## Тести та фікстури

- Новий набір `tests/test_farm_routes.py` покриває базові сценарії посадки/збору.
- `tests/conftest.py` налаштовано на спільну SQLite-базу для синхронних та асинхронних маршрутів.

## Подальші ідеї

- Додати сезонні культури з обмеженим часом доступності.
- Ввести щоденні/тижневі фермерські завдання, що взаємодіють з існуючою системою квестів.
- Підтримати соціальні елементи: відвідування ферм друзів або спільні фестивалі врожаю.
